<!DOCTYPE html>
<html>
    <head>

	<!-- This page allows opening and displaying FITS files using the fits.js package.
	 -->

	<title>FITS Viewer</title>

        <script language="JavaScript" type="text/javascript" src="rapport.js"></script>


    <script>

	    var NROIS = 2;			// number of ROIS -- sufficient for code but not for html
	    var fits;				// FITS instance
	    var last_mouse_loc;			// last-known mouse location, in FITS coords

	    // handy
	    function gebi (id) {
		return document.getElementById (id);
	    }


window.onload = function () {
   // "use strict";
  //  document.getElementById("boutonCharger").onkeyup = function () {
  //      chargerFichier("filesel", "fits_div");
  //  };
 //   document.getElementById("boutonCharger").onclick = function () {
  //      chargerFichier("filesel", "fits_div");
 //   };
		// instantiate a FITS handler with NROIS ROIs
		fits = new FITS (gebi ("fits_div"), NROIS);


		// turn off all but highest prioroty ROI iniitially
		for (var i = 1; i <= NROIS; i++) {
		    var state = (i == NROIS);
		 fits.enableROI (i, state);
	    gebi("display_roi_"+i).checked = state;
		}

		// add handler to report new mouse location
	//fits.addMouseHandler (onMouse);

		// add handler to report new ROI
	//fits.addROIChangedHandler (onROIChange);

		// connect callback when user selects a local file to display
		gebi ('filesel').addEventListener('change', handleLocalFileSelect, false);

		// connect to our mag glass canvas
	//	fits.addGlassCanvas (gebi('glass_canvas'));

		// connect clean up function
	
};



	    function handleLocalFileSelect(event) {

		var hiev = event.target;			// HTMLInputElement
		var fill = hiev.files;				// FileList
		var file = fill[0];				// File
		var reader = new FileReader();

		// define callback to display file after it is received
		reader.onload = function(event) {
		    var fr = event.target;			// FileReader
		    var ab = fr.result;				// ArrayBuffer
		    try {
			fits.setNewImage (file.name, ab);
			fits.showHeader(false);
		    } catch (e) {
			alert (e);
		    }
		};

		// read file, triggers onload when complete
		reader.readAsArrayBuffer(file);
	    }


    function showHeader () {
		fits.showHeader(true);
	    }










console.log('0000000000000000000000000000' + fill);

        </script>






    </head>

    <body>


<table>
<tr><td class='thick-bottom' >
<input type='file' id='filesel'/>
<button id='boutonCharger'>Affiche-moi le contenu du fichier</button>
	     <div id="fits_div"
		         style='width:617px; height:617px; position:relative; resize:both;
			 overflow:scroll; padding-right:17px; padding-bottom:17px; ' >
			 <!-- the 17 padding is to allow for the scroll bars in most browsers.
			   -->
		     </div>
</td></tr>

	<tr><td id='roi_label_0'>
			    <table width='100%'>
				<tr>
				
			
				    <td width='25%'>
					On:
					<input id='display_roi_1' type='checkbox' onclick='onDisplayROI(1)'>
					</input>
				    </td>
				</tr>


<tr><td class='thick-bottom' >
			    <button id='show_header' onclick='showHeader()'>
				Header
			    </button>
 </td></tr>
	<tr>
				    <td>
					<label id='roiinfo_0' class='monospaced' >
					    <br><br><br><br><br>
					</label>
				    </td>
				</tr>




{% comment %} 			<tr><td id='roi_label_2'>
			    <table width='100%'>
				<tr>
				
			
				    <td width='25%'>
					On:
					<input id='display_roi_2' type='checkbox' onclick='onDisplayROI(2)'>
					</input>
				    </td>
				</tr>
			    </table>
			</td></tr> 
			<tr><td class='thick-bottom' >
			    <h4></h4>
			    <table style='width:100%'>
				<tr>
				    <td>
					<canvas title='histogram. black line: black pixel; magenta: median; green: mean; white: white pixel'
					id='roihcanvas_2' style="width:280px;height:100px;position:relative">
					</canvas>
				    </td>
				</tr>
					    </table>

			</td></tr>
{% endcomment %}

{% comment %} 			<tr><td id='roi_label_1'>
			    <table width='100%'>
				<tr>
			
			
				    <td width='25%'>
					On:
					<input id='display_roi_1' type='checkbox' onclick='onDisplayROI(1)'>
					</input>
				    </td>
				</tr>
			    </table>
			</td></tr> 

			<tr><td>
			    <h4></h4>
			    <table style='width:100%'>
				<tr>
				    <td>
					<canvas title='histogram. black line: black pixel; magenta: median; green: mean; white: white pixel'
					id='roihcanvas_1' style="width:280px;height:100px;position:relative">
					</canvas>
				    </td>
				</tr>

			    </table>
			</td></tr>{% endcomment %}

	</table>

    </body>
</html>